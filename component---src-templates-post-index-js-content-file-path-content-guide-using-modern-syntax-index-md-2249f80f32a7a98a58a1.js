"use strict";(self.webpackChunkviolentmonkey_github_io=self.webpackChunkviolentmonkey_github_io||[]).push([[95],{1307:function(e,t,n){function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function r(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:String(t)}n.d(t,{RP:function(){return i}});var l=n(9474);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){var a,l,c;a=e,l=t,c=n[t],(l=r(l))in a?Object.defineProperty(a,l,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[l]=c})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const s=l.createContext({});function i(e){const t=l.useContext(s);return l.useMemo((()=>"function"==typeof e?e(t):o(o({},t),e)),[t,e])}},902:function(e,t,n){n.r(t),n.d(t,{Head:function(){return i.p},default:function(){return u}});var a=n(1307),r=n(9474);function l(e){const t=Object.assign({p:"p",h2:"h2",a:"a",span:"span",ul:"ul",li:"li",pre:"pre",code:"code",h3:"h3"},(0,a.RP)(),e.components);return r.createElement(r.Fragment,null,r.createElement(t.p,null,"Violentmonkey itself is built for modern browsers, to be precise, for Chrome >= 57 and Firefox >= 57. So if your browser has Violentmonkey, it is likely it also supports many ES6 features natively, for example, async / await, block-scoped variables, etc."),"\n",r.createElement(t.p,null,"However, there are many more cool features that are not fully supported by browsers, or some features such as TypeScript and ES modules that won't be supported in userscripts natively."),"\n",r.createElement(t.p,null,"In this tutorial we are going to create a project to compile ESNext and other modern syntax to browser compliant code."),"\n",r.createElement(t.h2,{id:"prerequisites",style:{position:"relative"}},r.createElement(t.a,{href:"#prerequisites","aria-label":"prerequisites permalink",className:"anchor before"},r.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Prerequisites"),"\n",r.createElement(t.ul,null,"\n",r.createElement(t.li,null,"Node >= 18"),"\n",r.createElement(t.li,null,"NPM >= 8.15.0"),"\n"),"\n",r.createElement(t.h2,{id:"initialization",style:{position:"relative"}},r.createElement(t.a,{href:"#initialization","aria-label":"initialization permalink",className:"anchor before"},r.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Initialization"),"\n",r.createElement(t.p,null,"Create a new directory for your script:"),"\n",r.createElement(t.pre,{className:"language-bash"},r.createElement(t.code,{className:"language-bash code-highlight"},r.createElement(t.span,{className:"code-line"},"$ ",r.createElement(t.span,{className:"token function"},"mkdir")," my-script\n"),r.createElement(t.span,{className:"code-line"},"$ ",r.createElement(t.span,{className:"token builtin class-name"},"cd")," my-script\n"))),"\n",r.createElement(t.p,null,"Thanks to ",r.createElement(t.code,null,"npx"),", we can generate the new project with a one-line command:"),"\n",r.createElement(t.pre,{className:"language-bash"},r.createElement(t.code,{className:"language-bash code-highlight"},r.createElement(t.span,{className:"code-line"},"$ npx ",r.createElement(t.span,{className:"token parameter variable"},"-p")," github:violentmonkey/generator-userscript ",r.createElement(t.span,{className:"token parameter variable"},"-p")," yo yo @violentmonkey/userscript\n"))),"\n",r.createElement(t.p,null,"Under the hood, we use Yeoman to create a project with JavaScript toolchain, compiling source code with Babel, and bundling them with Rollup. See the source code at ",r.createElement(t.a,{href:"https://github.com/violentmonkey/generator-userscript",target:"_blank",rel:"nofollow noopener noreferrer"},"GitHub"),"."),"\n",r.createElement(t.p,null,"Now we should get a project with the following structure:"),"\n",r.createElement(t.pre,{className:"language-text"},r.createElement(t.code,{className:"language-text code-highlight"},r.createElement(t.span,{className:"code-line"},"├── dist\n"),r.createElement(t.span,{className:"code-line"},"├── src\n"),r.createElement(t.span,{className:"code-line"},"│  ├── app.tsx\n"),r.createElement(t.span,{className:"code-line"},"│  ├── index.ts\n"),r.createElement(t.span,{className:"code-line"},"│  ├── meta.js\n"),r.createElement(t.span,{className:"code-line"},"│  ├── style.css\n"),r.createElement(t.span,{className:"code-line"},"│  └── style.module.css\n"),r.createElement(t.span,{className:"code-line"},"├── babel.config.js\n"),r.createElement(t.span,{className:"code-line"},"├── package.json\n"),r.createElement(t.span,{className:"code-line"},"├── postcss.config.cjs\n"),r.createElement(t.span,{className:"code-line"},"├── rollup.config.mjs\n"),r.createElement(t.span,{className:"code-line"},"├── tsconfig.json\n"),r.createElement(t.span,{className:"code-line"},"├── uno.config.ts\n"),r.createElement(t.span,{className:"code-line"},"└── README.md\n"))),"\n",r.createElement(t.p,null,"Source code files are kept in ",r.createElement(t.code,null,"src"),", and will be compiled to ",r.createElement(t.code,null,"dist/index.user.js"),"."),"\n",r.createElement(t.p,null,r.createElement(t.code,null,"src/meta.js")," contains the metadata of our script, see ",r.createElement(t.a,{href:"/api/metadata-block/"},"Metadata Block")," for more details. Do not add actual code to this file."),"\n",r.createElement(t.p,null,r.createElement(t.code,null,"src/index.ts")," is the entrance of our script, other files in ",r.createElement(t.code,null,"src")," can be imported."),"\n",r.createElement(t.h3,{id:"development",style:{position:"relative"}},r.createElement(t.a,{href:"#development","aria-label":"development permalink",className:"anchor before"},r.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Development"),"\n",r.createElement(t.pre,{className:"language-bash"},r.createElement(t.code,{className:"language-bash code-highlight"},r.createElement(t.span,{className:"code-line"},"$ ",r.createElement(t.span,{className:"token function"},"npm")," run dev\n"))),"\n",r.createElement(t.p,null,"Source code will be watched by the compiler and compiled to ",r.createElement(t.code,null,"dist")," once changed."),"\n",r.createElement(t.p,null,"By installing the compiled userscript from ",r.createElement(t.code,null,"dist"),", we can test and keep up with the latest code of our userscript. See also ",r.createElement(t.a,{href:"/posts/how-to-edit-scripts-with-your-favorite-editor/"},"How to edit scripts with your favorite editor"),"."),"\n",r.createElement(t.h3,{id:"building",style:{position:"relative"}},r.createElement(t.a,{href:"#building","aria-label":"building permalink",className:"anchor before"},r.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Building"),"\n",r.createElement(t.pre,{className:"language-bash"},r.createElement(t.code,{className:"language-bash code-highlight"},r.createElement(t.span,{className:"code-line"},"$ ",r.createElement(t.span,{className:"token function"},"npm")," run build\n"))),"\n",r.createElement(t.p,null,"In this way the source code will be compiled exactly once, and saved in ",r.createElement(t.code,null,"dist"),"."),"\n",r.createElement(t.p,null,"The version and author of our userscript will be synced with that in ",r.createElement(t.code,null,"package.json"),"."),"\n",r.createElement(t.h2,{id:"features",style:{position:"relative"}},r.createElement(t.a,{href:"#features","aria-label":"features permalink",className:"anchor before"},r.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Features"),"\n",r.createElement(t.p,null,"We have quite a few lovely features enabled by default:"),"\n",r.createElement(t.ul,null,"\n",r.createElement(t.li,null,"TypeScript"),"\n",r.createElement(t.li,null,"CSS modules (applied to files ending with ",r.createElement(t.code,null,".module.css"),")"),"\n",r.createElement(t.li,null,r.createElement(t.a,{href:"https://unocss.dev/",target:"_blank",rel:"nofollow noopener noreferrer"},"UnoCSS")),"\n",r.createElement(t.li,null,r.createElement(t.a,{href:"https://www.solidjs.com/",target:"_blank",rel:"nofollow noopener noreferrer"},"SolidJS")),"\n"),"\n",r.createElement(t.p,null,"Of course you don't have to use all these features. If you don't like them, you can simply ignore them or opt out by removing the plugins."),"\n",r.createElement(t.p,null,"To learn more about each feature, check ",r.createElement(t.a,{href:"/posts/features-in-userscript-generator/"},"Features in Userscript Generator"),"."))}var c=function(e={}){const{wrapper:t}=Object.assign({},(0,a.RP)(),e.components);return t?r.createElement(t,e,r.createElement(l,e)):l(e)},o=n(2349),s=n(301),i=n(9144);function m({location:e,data:t,children:n}){const{mdx:a}=t,l=(0,r.useRef)(),{pathname:c}=e,i="/"===c;return r.createElement(s.A,{location:e,sidebar:a.frontmatter.sidebar},r.createElement("main",{className:"flex-1 has-toc"},!i&&r.createElement("section",{className:"mb-10 pt-1"},r.createElement("h1",null,a.frontmatter.title)),r.createElement("section",{className:"items-start with-toc"},!i&&r.createElement(o.A,{data:a.tableOfContents,articleRef:l}),r.createElement("article",{className:"flex-1 min-w-0 mr-4",ref:l},n)),r.createElement("section",null,r.createElement("hr"),a.fields.slug.startsWith("posts/")&&r.createElement("div",{className:"mb-6"},r.createElement("em",null,"Published at ",a.frontmatter.date)))))}function u(e){return r.createElement(m,e,r.createElement(c,e))}},8931:function(e,t,n){n.d(t,{A:function(){return l}});let a=!1;try{const e=Object.defineProperty({},"passive",{get(){a=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(c){}const r=!!a&&{passive:!0};function l(e){return window.addEventListener("scroll",e,r),()=>window.removeEventListener("scroll",e,r)}},9144:function(e,t,n){n.d(t,{p:function(){return c}});var a=n(9474),r=n(8136),l=n(1713);function c(){const{site:{siteMetadata:{title:e,subtitle:t}}}=(0,r.useStaticQuery)("3202921338");return a.createElement(a.Fragment,null,a.createElement("title",null,e),a.createElement("meta",{name:"description",content:t}),a.createElement("meta",{name:"google-site-verification",content:"OKMYmcVuMfm9H_UjfNXPzRb2c0QoBtmZ7v1KwHNXnRQ"}),a.createElement("link",{rel:"shortcut icon",type:"image/png",href:l.A}))}},301:function(e,t,n){n.d(t,{A:function(){return w}});var a=n(8595),r=n(9474),l=(n(3763),n(993),n(1622),n(5376),n(8136));const c=(o=function(e){const{allMdx:{nodes:t}}=(0,l.useStaticQuery)("1116475411"),n=(0,r.useMemo)((()=>(null==e?void 0:e.match)&&(null==t?void 0:t.filter((t=>{var n;return(null===(n=t.frontmatter.sidebar)||void 0===n?void 0:n.match)===e.match})).sort(((e,t)=>e.frontmatter.sidebar.order-t.frontmatter.sidebar.order)))),[e,t]),[a,c]=(0,r.useState)(!1);return{matchedNodes:n,show:a,setShow:c,toggle:()=>{c(!a)}}},s=r.createContext(null),{Provider:function(e){var t=o(e.initialState);return r.createElement(s.Provider,{value:t},e.children)},useContainer:function(){var e=r.useContext(s);if(null===e)throw new Error("Component must be wrapped with <Container.Provider>");return e}});var o,s,i=n(4432),m=(n(6851),n(2445),n(8931));function u(){const e=(0,r.useRef)();return(0,r.useEffect)((()=>(0,m.A)((()=>{const t=document.documentElement,n=(document.body.scrollTop||t.scrollTop)/(t.scrollHeight-t.clientHeight),a=Math.min(1,n);e.current.style.transform=`scaleX(${a})`})))),r.createElement("div",{className:"w-full h-px"},r.createElement("div",{className:"w-full h-full origin-left bg-yellow-500 scale-x-0",ref:e}))}function d(){const[e,t]=(0,r.useState)(null);return e?r.createElement("div",{className:"bg-orange-200 px-4 text-sm flex","data-ga-category":"banner"},r.createElement("div",{className:"flex-1",dangerouslySetInnerHTML:{__html:e}}),r.createElement("div",{onClick:()=>{t(null)},className:"cursor-pointer text-gray-600","data-ga-label":"hide"},"✗")):null}function p(e){const{matchedNodes:t,toggle:n}=c.useContainer(),{data:a}=e,o=a.allMdx.nodes.reduce(((e,t)=>(t.frontmatter.redirect_from.forEach((n=>{e[n]=`/${t.fields.slug}`})),e)),{});return r.createElement("header",{className:"sticky top-0 left-0 right-0 bg-white z-10"},r.createElement("nav",null,r.createElement(l.Link,{to:"/",className:"nav-icon sm:hidden"},r.createElement("svg",{viewBox:"0 0 24 24"},r.createElement("path",{d:"M12 0l-12 12h4v12h5v-8h6v8h5v-12h4z"}))),t&&r.createElement("a",{className:"nav-icon lg:hidden",onClick:e=>{e.stopPropagation(),n()}},r.createElement("svg",{viewBox:"0 0 24 24"},r.createElement("path",{d:"M0 2h24v4h-24zM0 10h24v4h-24zM0 18h24v4h-24z"}))),r.createElement(l.Link,{to:"/",className:"brand hidden sm:block"},"Violentmonkey"),r.createElement("span",{className:"flex-1"}),r.createElement("div",{className:"overflow-auto min-w-0 flex whitespace-no-wrap"},a.site.siteMetadata.menu.map((e=>r.createElement(l.Link,{className:"nav-item",key:e.path,to:o[e.path]||e.path,activeClassName:"active",partiallyActive:!0},e.label))))),r.createElement(u,null))}var h=e=>r.createElement(l.StaticQuery,{query:"1700780748",render:t=>r.createElement(r.Fragment,null,r.createElement(d,null),r.createElement(p,(0,i.A)({},e,{data:t})))});function f(e){const{data:{site:{siteMetadata:{copyright:t,footer:n}}}}=e;return r.createElement("footer",{className:"flex mt-10 p-6 pb-16 border-t border-gray-400 lg:pb-6"},r.createElement("div",null,"Violentmonkey ",t),n.map((e=>r.createElement(l.Link,{className:"mx-2",key:e.path,to:e.path},e.label))))}var E=e=>r.createElement(l.StaticQuery,{query:"2344890832",render:t=>r.createElement(f,(0,i.A)({},e,{data:t}))});function v(){const{matchedNodes:e,setShow:t}=c.useContainer();return(0,r.useEffect)((()=>{if(e){const e=()=>{t(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}}),[e,t]),e?r.createElement("aside",{className:"sidebar"},r.createElement("ul",null,e.map(((e,t)=>r.createElement("li",{key:t},r.createElement(l.Link,{to:`/${e.fields.slug}`,activeClassName:"active"},e.frontmatter.title)))))):null}function g(){const[e,t]=(0,r.useState)(!1);return e?r.createElement("div",{className:"fixed bottom-0 right-0 w-full h-full flex flex-col items-end z-10 max-w-[320px] max-h-[450px]"},r.createElement("div",{className:"p-2 cursor-pointer",onClick:()=>t(!1)},r.createElement("svg",{viewBox:"0 0 12 12",className:"w-4 h-4"},r.createElement("path",{d:"M0 1L11 12L12 11L1 0zM11 0L0 11L1 12L12 1z",stroke:"none",fill:"currentColor"}))),r.createElement("iframe",{className:"flex-1 w-full",src:"https://discord.com/widget?id=995346102003965952&theme=dark",sandbox:"allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"})):r.createElement("a",{className:"fixed bottom-0 right-8 px-8 py-2 bg-blue-500 hover:bg-blue-600 text-white hover:text-white rounded-t-lg uppercase cursor-pointer",onClick:()=>t(!0)},"Open Chat")}const b=["sidebar"];function y(e){const{location:{pathname:t},children:n}=e,{show:a}=c.useContainer();return"/offline-plugin-app-shell-fallback/"===t?null:r.createElement(r.Fragment,null,r.createElement(h,null),r.createElement("div",{className:"relative flex z-0 "+(a?"sidebar-open":"")},r.createElement(v,null),n),r.createElement(E,null),r.createElement(g,null))}var w=e=>{let{sidebar:t}=e,n=(0,a.A)(e,b);return r.createElement(c.Provider,{initialState:t},r.createElement(y,n))}},2349:function(e,t,n){n.d(t,{A:function(){return o}});n(116),n(2445);var a=n(9474),r=n(8136),l=n(8931);function c({items:e}){return a.createElement("ul",null,e.map(((e,t)=>{const n=e.url.indexOf("#"),l=n<0?"#":e.url.slice(n);return a.createElement("li",{key:t},a.createElement(r.Link,{to:l},e.title),e.items&&a.createElement(c,{items:e.items}))})))}function o(e){const{className:t,data:n,articleRef:r}=e,o=(0,a.useRef)(),s=(0,a.useRef)();return(0,a.useEffect)((()=>{if(!n)return;const e=Array.from(o.current.querySelectorAll("a"));e.forEach((e=>{const t=decodeURIComponent(e.href.split("#")[1]||"");if(e.dataset.id=t,r.current){const n=r.current.querySelector(`#${CSS.escape(t)}`);n&&(e.textContent=n.textContent.trim())}}));return(0,l.A)((()=>{if(!r.current||!o.current)return;const{scrollTop:t}=document.body,n=e.map((e=>{const{id:n}=e.dataset,a=r.current.querySelector(`#${CSS.escape(n)}`);return a&&{id:n,a:e,offset:a.getBoundingClientRect().top-t-70}})).filter(Boolean),{a:a}=n.find(((e,t)=>{const a=n[t+1];return a&&a.offset>0}))||{};s.current&&(s.current.className=""),a&&(a.className="active"),s.current=a}))})),a.createElement("section",{className:`toc ${t||""}`,ref:o},(null==n?void 0:n.items)&&a.createElement(a.Fragment,null,a.createElement("h2",null,"Table of Contents"),a.createElement(c,{items:n.items})))}},1713:function(e,t,n){t.A=n.p+"static/vm-6437e4e5a400c6eff1c23ead4d549b0a.png"}}]);
//# sourceMappingURL=component---src-templates-post-index-js-content-file-path-content-guide-using-modern-syntax-index-md-2249f80f32a7a98a58a1.js.map