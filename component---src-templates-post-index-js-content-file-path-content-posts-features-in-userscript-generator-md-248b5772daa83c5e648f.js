"use strict";(self.webpackChunkviolentmonkey_github_io=self.webpackChunkviolentmonkey_github_io||[]).push([[251],{1307:function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function l(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var l=n.call(e,t||"default");if("object"!=r(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:String(t)}n.d(t,{RP:function(){return s}});var a=n(9474);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){var r,a,o;r=e,a=t,o=n[t],(a=l(a))in r?Object.defineProperty(r,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[a]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const c=a.createContext({});function s(e){const t=a.useContext(c);return a.useMemo((()=>"function"==typeof e?e(t):i(i({},t),e)),[t,e])}},8418:function(e,t,n){n.r(t),n.d(t,{Head:function(){return s.p},default:function(){return m}});var r=n(1307),l=n(9474);function a(e){const t=Object.assign({p:"p",a:"a",h2:"h2",span:"span",code:"code",ul:"ul",li:"li",strong:"strong"},(0,r.RP)(),e.components);return l.createElement(l.Fragment,null,l.createElement(t.p,null,l.createElement(t.a,{href:"https://github.com/violentmonkey/generator-userscript",target:"_blank",rel:"nofollow noopener noreferrer"},"Userscript Generator")," is a Yeoman generator to quickly initiate a new project for a userscript."),"\n",l.createElement(t.p,null,"See ",l.createElement(t.a,{href:"/guide/using-modern-syntax/"},"Using modern syntax")," for the usage."),"\n",l.createElement(t.p,null,"In this post we will dive into each feature and see why and how we use it, and whether we have different choices."),"\n",l.createElement(t.h2,{id:"css-modules",style:{position:"relative"}},l.createElement(t.a,{href:"#css-modules","aria-label":"css modules permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"CSS modules"),"\n",l.createElement(t.p,null,"Both global CSS (e.g. ",l.createElement(t.code,null,"style.css"),") and CSS modules (e.g. ",l.createElement(t.code,null,"style.module.css"),") are supported."),"\n",l.createElement(t.p,null,"A userscript usually works in different websites which may not be maintained by the script developer. So if the script provides independent UI in the website, it must be careful not to break the website and not to be broken by the website. We have two choices, shadow DOM and CSS modules."),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"Option 1: Shadow DOM","\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"Pros: Neat class names, no repeated prefix."),"\n",l.createElement(t.li,null,"Cons: It doesn't always work because the CSS can only be injected inside the shadow DOM root, which ",l.createElement(t.strong,null,"may be blocked by the CSP"),"."),"\n"),"\n"),"\n",l.createElement(t.li,null,"Option 2: CSS modules","\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"Pros: It can ",l.createElement(t.strong,null,"bypass the CSP issue")," because the CSS can be injected with the ",l.createElement(t.code,null,"GM_addStyle")," API."),"\n",l.createElement(t.li,null,"Cons: More code required, less readable class names in the DOM."),"\n"),"\n"),"\n"),"\n",l.createElement(t.p,null,"So if you expect your script to work in many different websites including those protected by CSP, CSS modules might be a better choice. Otherwise use global CSS with shadow DOM for simplicity."),"\n",l.createElement(t.h2,{id:"unocss",style:{position:"relative"}},l.createElement(t.a,{href:"#unocss","aria-label":"unocss permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"UnoCSS"),"\n",l.createElement(t.p,null,"UnoCSS is similar to TailwindCSS but arguably more flexible and reliable."),"\n",l.createElement(t.p,null,"At the time of writing, TailwindCSS does not work well for userscripts, because it either injects reset CSS breaking the style of the host, or misses default values leading to invalid CSS output. This is a bug and has occurred before."),"\n",l.createElement(t.p,null,"By using UnoCSS or its alternatives, ",l.createElement(t.strong,null,"the effort of maintaining CSS code is significantly reduced"),"."),"\n",l.createElement(t.p,null,"We just write class names based on what we need, and the CSS code will be generated automatically. If later we don't need this class name any more, the related CSS code will also be pruned."),"\n",l.createElement(t.h2,{id:"solidjs",style:{position:"relative"}},l.createElement(t.a,{href:"#solidjs","aria-label":"solidjs permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"SolidJS"),"\n",l.createElement(t.p,null,"SolidJS is a light-weight UI library. It has some similarities with React, but much lighter and easier to use for a small project like a userscript."),"\n",l.createElement(t.p,null,"However, SolidJS doesn't have an official UMD or IIFE package. In other words, there is no easy way for us to import SolidJS as a single file resource using ",l.createElement(t.code,null,"@require"),"."),"\n",l.createElement(t.p,null,"We have several options here:"),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Option 1: import it and bundle it in the userscript."),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"Pros: Simple to go."),"\n",l.createElement(t.li,null,"Cons: ",l.createElement(t.strong,null,"Bloated userscript size and worse readability"),"."),"\n"),"\n"),"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Option 2: import it using dynamic import at runtime."),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"Pros: Better readability, smaller file size."),"\n",l.createElement(t.li,null,"Cons: ",l.createElement(t.strong,null,"An obvious delay before the UI appears"),"."),"\n",l.createElement(t.li,null,"Suggestion: If the delay is acceptable, this might be a good choice."),"\n"),"\n"),"\n",l.createElement(t.li,null,"\n",l.createElement(t.p,null,"Option 3: compile SolidJS as a UMD package and use it in different scripts."),"\n",l.createElement(t.p,null,"This is exactly what I have done in the generator. Check the compiled file at ",l.createElement(t.a,{href:"https://cdn.jsdelivr.net/npm/@violentmonkey/dom@2/dist/solid.js",target:"_blank",rel:"nofollow noopener noreferrer"},"jsdelivr")," and the source code at ",l.createElement(t.a,{href:"https://github.com/violentmonkey/vm-dom/blob/master/src/solid.ts",target:"_blank",rel:"nofollow noopener noreferrer"},"@violentmonkey/dom"),"."),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"Pros: Good readability, smaller file size, fast loading, reusable common assets between different scripts."),"\n",l.createElement(t.li,null,"Cons: Need to maintain an extra file, and it might not always be up-to-date."),"\n"),"\n"),"\n"),"\n",l.createElement(t.p,null,"Absolutely, every decision involves a trade-off, and ultimately, you have to make your own choices."),"\n",l.createElement(t.h2,{id:"summary",style:{position:"relative"}},l.createElement(t.a,{href:"#summary","aria-label":"summary permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Summary"),"\n",l.createElement(t.p,null,"Thanks to the powerful tools, the development of a userscript is getting much smoother."),"\n",l.createElement(t.p,null,"We can use the generator above to quickly create a new userscript with modern tech stack."))}var o=function(e={}){const{wrapper:t}=Object.assign({},(0,r.RP)(),e.components);return t?l.createElement(t,e,l.createElement(a,e)):a(e)},i=n(2349),c=n(301),s=n(9144);function u({location:e,data:t,children:n}){const{mdx:r}=t,a=(0,l.useRef)(),{pathname:o}=e,s="/"===o;return l.createElement(c.A,{location:e,sidebar:r.frontmatter.sidebar},l.createElement("main",{className:"flex-1 has-toc"},!s&&l.createElement("section",{className:"mb-10 pt-1"},l.createElement("h1",null,r.frontmatter.title)),l.createElement("section",{className:"items-start with-toc"},!s&&l.createElement(i.A,{data:r.tableOfContents,articleRef:a}),l.createElement("article",{className:"flex-1 min-w-0 mr-4",ref:a},n)),l.createElement("section",null,l.createElement("hr"),r.fields.slug.startsWith("posts/")&&l.createElement("div",{className:"mb-6"},l.createElement("em",null,"Published at ",r.frontmatter.date)))))}function m(e){return l.createElement(u,e,l.createElement(o,e))}},8931:function(e,t,n){n.d(t,{A:function(){return a}});let r=!1;try{const e=Object.defineProperty({},"passive",{get(){r=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(o){}const l=!!r&&{passive:!0};function a(e){return window.addEventListener("scroll",e,l),()=>window.removeEventListener("scroll",e,l)}},9144:function(e,t,n){n.d(t,{p:function(){return o}});var r=n(9474),l=n(8136),a=n(1713);function o(){const{site:{siteMetadata:{title:e,subtitle:t}}}=(0,l.useStaticQuery)("3202921338");return r.createElement(r.Fragment,null,r.createElement("title",null,e),r.createElement("meta",{name:"description",content:t}),r.createElement("meta",{name:"google-site-verification",content:"OKMYmcVuMfm9H_UjfNXPzRb2c0QoBtmZ7v1KwHNXnRQ"}),r.createElement("link",{rel:"shortcut icon",type:"image/png",href:a.A}))}},301:function(e,t,n){n.d(t,{A:function(){return w}});var r=n(8595),l=n(9474),a=(n(3763),n(993),n(1622),n(5376),n(8136));const o=(i=function(e){const{allMdx:{nodes:t}}=(0,a.useStaticQuery)("1116475411"),n=(0,l.useMemo)((()=>(null==e?void 0:e.match)&&(null==t?void 0:t.filter((t=>{var n;return(null===(n=t.frontmatter.sidebar)||void 0===n?void 0:n.match)===e.match})).sort(((e,t)=>e.frontmatter.sidebar.order-t.frontmatter.sidebar.order)))),[e,t]),[r,o]=(0,l.useState)(!1);return{matchedNodes:n,show:r,setShow:o,toggle:()=>{o(!r)}}},c=l.createContext(null),{Provider:function(e){var t=i(e.initialState);return l.createElement(c.Provider,{value:t},e.children)},useContainer:function(){var e=l.useContext(c);if(null===e)throw new Error("Component must be wrapped with <Container.Provider>");return e}});var i,c,s=n(4432),u=(n(6851),n(2445),n(8931));function m(){const e=(0,l.useRef)();return(0,l.useEffect)((()=>(0,u.A)((()=>{const t=document.documentElement,n=(document.body.scrollTop||t.scrollTop)/(t.scrollHeight-t.clientHeight),r=Math.min(1,n);e.current.style.transform=`scaleX(${r})`})))),l.createElement("div",{className:"w-full h-px"},l.createElement("div",{className:"w-full h-full origin-left bg-yellow-500 scale-x-0",ref:e}))}function d(){const[e,t]=(0,l.useState)(null);return e?l.createElement("div",{className:"bg-orange-200 px-4 text-sm flex","data-ga-category":"banner"},l.createElement("div",{className:"flex-1",dangerouslySetInnerHTML:{__html:e}}),l.createElement("div",{onClick:()=>{t(null)},className:"cursor-pointer text-gray-600","data-ga-label":"hide"},"✗")):null}function h(e){const{matchedNodes:t,toggle:n}=o.useContainer(),{data:r}=e,i=r.allMdx.nodes.reduce(((e,t)=>(t.frontmatter.redirect_from.forEach((n=>{e[n]=`/${t.fields.slug}`})),e)),{});return l.createElement("header",{className:"sticky top-0 left-0 right-0 bg-white z-10"},l.createElement("nav",null,l.createElement(a.Link,{to:"/",className:"nav-icon sm:hidden"},l.createElement("svg",{viewBox:"0 0 24 24"},l.createElement("path",{d:"M12 0l-12 12h4v12h5v-8h6v8h5v-12h4z"}))),t&&l.createElement("a",{className:"nav-icon lg:hidden",onClick:e=>{e.stopPropagation(),n()}},l.createElement("svg",{viewBox:"0 0 24 24"},l.createElement("path",{d:"M0 2h24v4h-24zM0 10h24v4h-24zM0 18h24v4h-24z"}))),l.createElement(a.Link,{to:"/",className:"brand hidden sm:block"},"Violentmonkey"),l.createElement("span",{className:"flex-1"}),l.createElement("div",{className:"overflow-auto min-w-0 flex whitespace-no-wrap"},r.site.siteMetadata.menu.map((e=>l.createElement(a.Link,{className:"nav-item",key:e.path,to:i[e.path]||e.path,activeClassName:"active",partiallyActive:!0},e.label))))),l.createElement(m,null))}var f=e=>l.createElement(a.StaticQuery,{query:"1700780748",render:t=>l.createElement(l.Fragment,null,l.createElement(d,null),l.createElement(h,(0,s.A)({},e,{data:t})))});function p(e){const{data:{site:{siteMetadata:{copyright:t,footer:n}}}}=e;return l.createElement("footer",{className:"flex mt-10 p-6 pb-16 border-t border-gray-400 lg:pb-6"},l.createElement("div",null,"Violentmonkey ",t),n.map((e=>l.createElement(a.Link,{className:"mx-2",key:e.path,to:e.path},e.label))))}var E=e=>l.createElement(a.StaticQuery,{query:"2344890832",render:t=>l.createElement(p,(0,s.A)({},e,{data:t}))});function v(){const{matchedNodes:e,setShow:t}=o.useContainer();return(0,l.useEffect)((()=>{if(e){const e=()=>{t(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}}),[e,t]),e?l.createElement("aside",{className:"sidebar"},l.createElement("ul",null,e.map(((e,t)=>l.createElement("li",{key:t},l.createElement(a.Link,{to:`/${e.fields.slug}`,activeClassName:"active"},e.frontmatter.title)))))):null}function b(){const[e,t]=(0,l.useState)(!1);return e?l.createElement("div",{className:"fixed bottom-0 right-0 w-full h-full flex flex-col items-end z-10 max-w-[320px] max-h-[450px]"},l.createElement("div",{className:"p-2 cursor-pointer",onClick:()=>t(!1)},l.createElement("svg",{viewBox:"0 0 12 12",className:"w-4 h-4"},l.createElement("path",{d:"M0 1L11 12L12 11L1 0zM11 0L0 11L1 12L12 1z",stroke:"none",fill:"currentColor"}))),l.createElement("iframe",{className:"flex-1 w-full",src:"https://discord.com/widget?id=995346102003965952&theme=dark",sandbox:"allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"})):l.createElement("a",{className:"fixed bottom-0 right-8 px-8 py-2 bg-blue-500 hover:bg-blue-600 text-white hover:text-white rounded-t-lg uppercase cursor-pointer",onClick:()=>t(!0)},"Open Chat")}const g=["sidebar"];function y(e){const{location:{pathname:t},children:n}=e,{show:r}=o.useContainer();return"/offline-plugin-app-shell-fallback/"===t?null:l.createElement(l.Fragment,null,l.createElement(f,null),l.createElement("div",{className:"relative flex z-0 "+(r?"sidebar-open":"")},l.createElement(v,null),n),l.createElement(E,null),l.createElement(b,null))}var w=e=>{let{sidebar:t}=e,n=(0,r.A)(e,g);return l.createElement(o.Provider,{initialState:t},l.createElement(y,n))}},2349:function(e,t,n){n.d(t,{A:function(){return i}});n(116),n(2445);var r=n(9474),l=n(8136),a=n(8931);function o({items:e}){return r.createElement("ul",null,e.map(((e,t)=>{const n=e.url.indexOf("#"),a=n<0?"#":e.url.slice(n);return r.createElement("li",{key:t},r.createElement(l.Link,{to:a},e.title),e.items&&r.createElement(o,{items:e.items}))})))}function i(e){const{className:t,data:n,articleRef:l}=e,i=(0,r.useRef)(),c=(0,r.useRef)();return(0,r.useEffect)((()=>{if(!n)return;const e=Array.from(i.current.querySelectorAll("a"));e.forEach((e=>{const t=decodeURIComponent(e.href.split("#")[1]||"");if(e.dataset.id=t,l.current){const n=l.current.querySelector(`#${CSS.escape(t)}`);n&&(e.textContent=n.textContent.trim())}}));return(0,a.A)((()=>{if(!l.current||!i.current)return;const{scrollTop:t}=document.body,n=e.map((e=>{const{id:n}=e.dataset,r=l.current.querySelector(`#${CSS.escape(n)}`);return r&&{id:n,a:e,offset:r.getBoundingClientRect().top-t-70}})).filter(Boolean),{a:r}=n.find(((e,t)=>{const r=n[t+1];return r&&r.offset>0}))||{};c.current&&(c.current.className=""),r&&(r.className="active"),c.current=r}))})),r.createElement("section",{className:`toc ${t||""}`,ref:i},(null==n?void 0:n.items)&&r.createElement(r.Fragment,null,r.createElement("h2",null,"Table of Contents"),r.createElement(o,{items:n.items})))}},1713:function(e,t,n){t.A=n.p+"static/vm-6437e4e5a400c6eff1c23ead4d549b0a.png"}}]);
//# sourceMappingURL=component---src-templates-post-index-js-content-file-path-content-posts-features-in-userscript-generator-md-248b5772daa83c5e648f.js.map